<div class="pagetitle">
    <h1>Encaissement </h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{path('app_admin')}}">Tableau de board</a></li>
        <li class="breadcrumb-item active">Liste</li>
      </ol>
    </nav>
  </div>
<section class="section">
    <div class="row">
      <div class="col-lg-12">

        <div class="card">
        
          <div class="card-body px-3 px-lg-4 py-lg-5 py-5">
            <div class="row">
                <div class="col-md-6 col-12" style="border-right: solid 2px #5e1212;">
                    <div class="affaire">
                        <span class="id-benefice" data-benefice="{{benefice.id}}"></span>
                        <h4 class="fw-bold mb-3">Encaissement</h4>
                        <hr>
                        <div class="content">
                          <div class="alert alert-warning">
                            <p>
                                <strong>Designation : </strong> {{benefice.designation}}
                            </p>
                            <p>
                                <strong>Paiement en espèce : </strong> {{benefice.espece|number_format(0,',',' ')}} Ariary
                            </p>
                            <p>
                                <strong>Paiment par mobile money : </strong> {{benefice.mobileMoney|number_format(0,',',' ')}} Ariary
                            </p>
                            <p>
                                <strong>Total à gagné : </strong> {{benefice.total|number_format(0,',',' ')}} Ariary
                            </p>

                            <p class="d-flex justify-content-center">
                                <a href="#" class="btn btn-info btn-sm px-3">Créer comptabilité</a>
                            </p>
                          </div>
                        </div>
                        
                    </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="depense">
                    <div class="d-flex justify-content-between align-items-center">
                      <h4 class="fw-bold mb-0">Dépenses</h4>
                      <a href="#" onclick="return newDepense()" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle-fill"></i></a>
                    </div>
                    <hr>
                    <div class="content">
                      {% if depensesToday|length > 0 %}
                      {% set grandTotal = 0 %}
                        {% for depense in depensesToday %}
                          {% set grandTotal = grandTotal + depense.total %}
                          <div class="row alert alert-info" style="margin-left: 1px;">
                              <div class="col-md-4 col-12">
                                <p><i class="bi bi-dot fs-4"></i> {{depense.designation}} </p>
                              </div>
                              <div class="col-md-2 col-12">
                                <p>x {{depense.nombre}} </p>
                              </div>
                              <div class="col-md-2 col-12">
                                <p> {{depense.prix|number_format(0,',',' ')}} Ar </p>
                              </div>
                              <div class="col-md-2 col-12">
                                <p> {{depense.total|number_format(0,',',' ')}} Ar </p>
                              </div>
                              <div class="col-md-2 col-12">
                                <a href="#" onclick="return updateDepense({{depense.id}})" class="text-primary"><i class="bi bi-pencil-square"></i></a>
                                <a href="#" onclick=" return deleteDepense({{depense.id}})" class="text-danger"><i class="bi bi-trash-fill"></i></a>
                              </div>
                          </div>
                        {% endfor %}
                        <div class="alert alert-warning">
                          Grand total : {{grandTotal|number_format(0,',',' ')}} Ariary
                        </div>
                        <div class="pdf">
                          <a href="#" onclick="return createFactureDepense()" class="btn btn-primary btn-sm px-3">Créer une facture</a>
                        </div>
                      {% else %}
                        <div class="alert alert-warning">
                          Aucun depense pour aujourd'hui
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
            </div>

          </div>
        </div>

      </div>
    </div>
    <div id="blocModalComptabiliteEmpty"></div>
</section>

<script>
    $(document).ready(function() {
        $('#tab-historique-produit').removeClass('active').empty();
        $('#tab-historique-affaire').removeClass('active').empty();
        $('#tab-produit-date-peremption').removeClass('active').empty();
        $('#tab-inventaire-produit').css('display','none');

        $('#tab-fiche-fournisseur').removeClass('active').empty();
        $('#tab-quantite-vendu').removeClass('active').empty();
        $('#tab-notification').removeClass('active').empty();
        $('.tab-user').removeClass('active');
        $('.tab-permission').removeClass('active');
        $('.tab-privilege').removeClass('active');
        $('.tab-cat-permission').removeClass('active');
        $('#tab-dashboard').removeClass('active');
        $('#tab-profile').removeClass('active');
        $('#tab-utilisateur').removeClass('active');
        $('#tab-permission').removeClass('active');
        $('#tab-privilege').removeClass('active');
        $('#tab-categorie-permission').removeClass('active');
        $('#tab-application').removeClass('active');
        $('.tab-categorie').removeClass('active');
        $('#tab-produit-categorie').removeClass('active');
        $('.tab-produit-categorie').removeClass('active');
        $('#tab-categorie').removeClass('active');  
         $('#tab-compte_1').removeClass('active');
        $('#tab-compte_2').removeClass('active');
        $('#tab-produit-type').removeClass('active');
        $('.tab-import-produit').css('display', 'none');
        $('#tab-import-produit').css('display', 'none');
        $('#tab-transfert-produit').css('display', 'none');
        $('#affaires_client').removeClass('active').empty();
        $('#affaires_fournisseur').removeClass('active').empty();
        $('#tab-info-affaire').removeClass('active').empty();
        $('#tab-financier-affaire').removeClass('active').empty();
        $('#tab-fiche-client').removeClass('active').empty();
        $('#tab-facture').css('display', 'none');
        $('#tab-facture-affaire').css('display', 'none');     
        $('#tab-nouveau-facture').css('display','none');
        $('#tab-devis').css('display','none');
        $('#tab-commande').css('display','none');
        $('#tab-echeance').css('display','none');
        $('#tab-produit-image').removeClass('active');
        $('#tab-stock').removeClass('active');
        $('#tab-depot').css('display', 'none');
        $('#tab-comptabilite').css('display', 'none');
        $('#tab-benefice').css('display', 'block');

    });
</script>

<script>
     function createFactureDepense() {
        const idBenefice = $('.id-benefice').data('benefice');
        if (confirm('Voulez vous vraiment créer cette facture?')) {
            setTimeout(function() {
                $.ajax({
                url: '/admin/depense/facture',
                type: 'POST',
                //data: {id: id},
                success: function (response) {
                    setTimeout(function () {
                        toastr.options = {
                            closeButton: true,
                            progressBar: true,
                            showMethod: 'slideDown',
                            timeOut: 1000
                        };
                        toastr.success('Avec succèss', 'Création facture fait');
                        
                        showTabBenefice(idBenefice);

                        if (response.pdfUrl) {
                            window.open(response.pdfUrl, '_blank');
                        }

                    }, 800);
                    
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // Gérer l'erreur (par exemple, afficher un message d'erreur)
                    alert('Erreur lors de la création de facture.');
                }
            });
        
            }, 500);
           
        }
    }
  
</script>